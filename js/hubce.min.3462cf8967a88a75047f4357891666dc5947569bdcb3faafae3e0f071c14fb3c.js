"use strict";const VERIFY_EMAIL_URL=API_BASE_URL+"/connect/email/verify",REFRESH_LICENSE_URL=API_BASE_URL+"/licenses/hub/refresh";class HubCE{constructor(e,t,n,s){this._form=e,this._feedbackData=t,this._submitData=n,this._searchParams=s,this._submitData.oldLicense=s.get("oldLicense"),this._submitData.returnUrl=s.get("returnUrl"),s.get("verifiedEmail")&&(t.currentStep=1,t.emailVerified=!0)}submit(){this._feedbackData.currentStep===0?this.validateEmail():this._feedbackData.currentStep===1?this.sendConfirmationEmail():this._feedbackData.currentStep===2&&this.getHubLicense()}validateEmail(){if(!$(this._form)[0].checkValidity()){$(this._form).find(":input").addClass("show-invalid"),this._feedbackData.errorMessage="Please fill in all required fields.";return}this.onValidationSucceeded()}onValidationFailed(e){this._feedbackData.inProgress=!1,this._feedbackData.errorMessage=e}onValidationSucceeded(){this._feedbackData.currentStep++,this._feedbackData.inProgress=!1,this._feedbackData.errorMessage=""}sendConfirmationEmail(){if(!$(this._form)[0].checkValidity()){$(this._form).find(":input").addClass("show-invalid"),this._feedbackData.errorMessage="Please fill in all required fields.";return}this._feedbackData.success=!1,this._feedbackData.inProgress=!0,this._feedbackData.errorMessage="",$.ajax({url:VERIFY_EMAIL_URL,type:"POST",data:{email:this._submitData.email,oldLicense:this._submitData.oldLicense,returnUrl:this._submitData.returnUrl,verifyCaptcha:this._submitData.captcha,verifyEmail:this._submitData.email,verifyTarget:"registerhubce"}}).done(e=>{this.onRequestSucceeded(),this._submitData.acceptNewsletter&&subscribeToNewsletter(this._submitData.email,7)}).fail(e=>{this.onRequestFailed(e.responseJSON?.message||"Sending confirmation email failed.")})}getHubLicense(){this._feedbackData.inProgress=!0,this._feedbackData.errorMessage="",$.ajax({url:REFRESH_LICENSE_URL,type:"POST",data:{token:this._submitData.oldLicense,captcha:this._submitData.captcha}}).done(e=>{this._feedbackData.licenseText=e,this._feedbackData.inProgress=!1}).fail(e=>{this.onRequestFailed(e.responseJSON?.message||"Fetching license failed.")})}onRequestFailed(e){this._feedbackData.inProgress=!1,this._feedbackData.errorMessage=e}onRequestSucceeded(){this._feedbackData.emailSent=!0,this._feedbackData.inProgress=!1,this._feedbackData.errorMessage=""}}