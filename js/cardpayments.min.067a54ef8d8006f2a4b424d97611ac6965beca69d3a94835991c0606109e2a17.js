"use strict";const STRIPE_PREPARE_PAYMENT_URL=API_BASE_URL+"/donations/stripe/payments/prepare",STRIPE_SUBSCRIPTION_CHECKOUT_URL=API_BASE_URL+"/donations/stripe/subscriptions/checkout";class OneTimePayment{constructor(e){this._status=e}initStripeField(e,t,n){let s=document.createElement("div");$(s).hide(),$(e).after(s),$(e).attr("placeholder",t),$(e).attr("disabled",!0),this._stripe=$.ajax({url:"https://js.stripe.com/clover/stripe.js",cache:!0,dataType:"script"}).then(e=>window.Stripe(STRIPE_PK)),this._card=this._stripe.then(t=>{let o=t.elements({locale:n}).create("card",{style:{base:{fontFamily:"Open Sans, sans-serif",fontSize:"16px",lineHeight:"1.5"}}});return o.mount(s),o.on("ready",t=>{$(s).show(),$(e).hide(),o.focus()}),o.on("change",this.onCardChanged.bind(this)),o})}onCardChanged(e){this._status.validCardNum=e.complete,e.error?this._status.errorMessage=e.error.message:this._status.errorMessage=""}charge(e,t){this._status.inProgress=!0,this._status.errorMessage="",this._status.success=!1;let n=$.ajax({url:STRIPE_PREPARE_PAYMENT_URL,type:"POST",data:{currency:t,amount:e,captcha:this._status.captcha}});Promise.all([this._stripe,this._card,n]).then(([e,t,n])=>{e.confirmCardPayment(n.client_secret,{payment_method:{card:t}}).then(function(e){e.error?this.onPaymentFailed(e.error):e.paymentIntent.status==="succeeded"&&this.onPaymentSucceeded()}.bind(this))})}onPaymentFailed(e){console.warn("Stripe payment failed with error",e),this._status.success=!1,this._status.errorMessage=e.message,this._status.inProgress=!1}onPaymentSucceeded(){console.info("Stripe payment succeeded!"),this._status.success=!0,this._status.errorMessage="",this._status.inProgress=!1}}class RecurringPayment{constructor(e){this._status=e}checkout(e,t,n){this._status.inProgress=!0,this._status.errorMessage="";const s=window.location.href.split("#")[0]+"thanks",o=window.location.href;$.ajax({url:STRIPE_SUBSCRIPTION_CHECKOUT_URL,type:"POST",data:{amount:parseInt(e),currency:t,successUrl:s,cancelUrl:o,locale:n,captcha:this._status.captcha}}).then(e=>{window.location.href=e.url}).catch(e=>{console.error("Failed to create checkout session:",e),this._status.errorMessage=e.responseJSON?.message||"Failed to create checkout session",this._status.inProgress=!1})}}